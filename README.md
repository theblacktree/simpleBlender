这是一个模仿blender写的项目，致力于实现blender中的一些功能，目前做了简单的一些功能，后续会继续添加。

# 一.开发环境

使用Qt6.5.3, 编译器使用mingw1120_64；

opengl版本：4.x

opencv版本：4.5.5

glm矩阵计算库：1.0.1

glew:2.2.0

笔记本gpu: GTX3050TI

# 二.阶段效果图

![屏幕截图 2025-05-21 000656](F:/屏幕截图 2025-05-21 000656.png)



![屏幕截图 2025-05-21 000516](F:/屏幕截图 2025-05-21 000516.png)

![屏幕截图 2025-05-21 000408](F:/屏幕截图 2025-05-21 000408.png)

![屏幕截图 2025-05-20 235526](F:/屏幕截图 2025-05-20 235526.png)

该效果图是银环少女的一部分。后面优化了右下角设置部分，使用了可滑动的lineEdit，并实现了可伸缩的窗体作为属性管理器的一部分。

![image-20250528231853380](../../../Users/杀杀杀/AppData/Roaming/Typora/typora-user-images/image-20250528231853380.png)

新的属性编辑器，使用scroll area支持上下滑动

# 三.opengl项目主要功能实现

**1.实现了物体的一整套的渲染流程。**

实现了立方体，球体，圆环的物体渲染，设计了vertex shader 和fragment shader, 读取编译着色器程序；通过设置物体的顶点数组，使用vao,vbo,ebo进行物体顶点的上传gpu,并进行绘制。

**2.实现灯光部分的效果**

使用结构体表示灯光的各项属性，如位置，强度，方向，聚光灯的内外角等。将所有灯光属性组成结构体数组，上传到着色器的ubo中。在片段着色器中使用ubo灯光进行所有灯光的读取渲染。

**3.实现摄像机设置**

可以创建摄像机，在物体管理中选中某摄像机并点击切换摄像机即可切换到该视角；同时可以设置摄像机的各种属性，如水平转向，上下视角移动，近裁剪面和远裁剪面等。

**4.实现物体的材质设置**

使用pbr的材质设置，包括金属度，粗糙度，折射率。

**5.实现物体的贴图功能**

可以创建物体的漫反射贴图和法线贴图，以及移除功能。

**6.图片的保存功能**

使用帧缓冲区读取图像，使用opencv保存图像。

# 四.项目主要框架

项目交互由MainWindow完成，同时创建物体及设置属性。主界面包含一个opengl界面，一个treeView管理物体，一个tabWidget属性管理器设置各种属性，一些按钮用于创建物体灯光摄像机。

glWidget是资源的管理器，主要负责渲染的流程，initializeGL()，paintGL，resizeGL，同时它管理所有的物体，灯光，摄像机的指针，管理他们的生命周期，管理着色器。

logger类实现了简单的异步日志功能，单例模式，使用单独线程读取写入文件，并使用独占锁和条件变量确保线程安全。

单例类的贴图管理器用于贴图的管理功能，避免重复载入。

物体灯光类主要是各类型物体及灯光的实现。

其他ui文件及h.cpp文件用于属性管理器的各页。

# 五.Qt使用

使用了自定义的模型视图机制设计treeView,用于管理各物体灯光摄像机的删除及选中功能。当选中某物体时属性界面会动态地显示该物体的各项属性。同时该模型支持更改物体灯光摄像机名字，交由glWidget类管理。

使用自定义的lineEdit，该lineEdit使用一个QLineEidt和两个位于两侧的pushButton,使用QDoubleVaild使只支持输入double类型数据，点击左右的按钮会增加或减少lineEdit的0.01。同时实现lineEdit的鼠标按压滑动效果，可以随意地更改lineEdit值，同时绑定了信号槽机制，使得lineEdit值改变时可以实时地显示渲染变化。

使用QSpacerItem和布局，在属性管理器中可以动态地显示各属性界面，也可以折叠各属性窗体。

# 六. C++编程

1.使用类的继承机制，物体，灯光均使用了继承，并使用基类指针去管理各继承类实例。

2.模板的使用，使用单例类模板来实现任意的单例类，使用模板特化来组成各类灯光的属性结构体。使用if constexpr (std::is_same_v)在编译期进行不同类型物体的操作，不同类型指物体，灯光，摄像机。

3.为了区分不同的子类，在各类中实现了基类的同名函数，以返回它的类的枚举类变量。

4.单例logger类，异步地写入日志，使用条件变量结合mutex及unique_lock进行线程安全保护，线程会在写完后退出。

5.filesystem和wstring实现了windows下复杂路径的贴图读取。

6.使用opencv进行贴图图片的读取变换保存。





